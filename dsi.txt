Fileuploadbroker静态代码块设置线程池属性，并submit线程，当有订阅任务配置了上传时就会拉起线程。
干活的有两个线程，一个是传文件的线程，一个是补传的线程

Fileuploadhander所有数据处理完成后都会经过几个hander，上传这个hander是最后一步的。之前有压缩啊，生成chkey校验文件这些东西。
最后一步会把生成的结果文件添加到上传队列中去

每个订阅至少对应一个队列，不会因为某一方死掉之后全部死掉

下载线程池
过滤
上传
超时线程池:每两分钟运行一次，先查一下数据库拿到所有文件上传的订阅任务，查一下订阅的导出路径下有没有未上传成功的文件
达到老化时长的文件会加到文件导出目录下的待上传目录下，再上传三次，如果还不成功。就老化掉
stream流式上传线程池


从队列中获取上传文件，每10个文件起一个task

如果已经提交到task，在文件列表中给文件添加后缀.waiting，文件后缀.tmp
上传完成.commited，文件后缀.dat
如果上传失败，继续修改为.waiting状态，再次加入队列

多路上传:扫描上传节点列表。多路上传文件列表中有多个零时文件和一个上级目录，只有全部上传成功后上级目录后缀才会变成completed，并把子目录删掉，不然下次还会扫描

每个文件在上传前先判断下连接还在不在，不在的话重新建链

如果文件已经上传完成了，会查下文件大小和本地的是否一致，如果一致就上传成功，如果失败就抛异常重新上传一遍

注册用户数据变更时的监听
dsi服务器ip变更的监听
订阅信息变更监听
话单字段更新监听
数据源配置的变更监听
号码加密策略变更监听
加解密key变更监听

创建订阅用户
添加数据源
添加目的数据源
添加话单
添加订阅

用户表
用户id
用户名，用户登录dsi服务器时用的用户名
密码
描述，用户的描述
是否有效，1有效0无效
用户类型
状态
修改时间
登录失败次数
登录失败时间
上次登录ip
上次登录时间
上次登出时间
锁定时长
第三方ip，仅允许这些ip地址使用该用户登录dsi服务器
接口协议，用户登录dsi服务器使用的协议ftp/sftp
告警阈值，该用户目录下的文件达到一定大小后发送邮件告警
恢复阈值
邮箱
发送周期，达到告警阈值后多久发一次

话单表
id
名称
中文名
描述
是否启用
分隔符，字段之间的分隔符
老化时长，没隔多久清空一次已经获取的文件列表
编码格式
元数据表名
数据源类型
路径，该话单去数据源服务器取数据的路径
是否生成校验文件

话单字段表
id
话单id，属于哪个话单
名称
描述
数据类型，该字段的数据类型(bigint double varchar)
索引，字段在话单中的索引值
字段允许最大长度
是否启用
加密类型

数据源表
id
名称
类型
ip，数据源ip地址
ip类型，1为内部通信
子网掩码，数据源ip地址的子网掩码
描述
用户名，登录该数据源使用的用户名
密码
协议，跟数据源传输数据使用的协议
端口

订阅信息表
id
用户id，当前登录用户id
话单id
订阅方式，0一次1周期2实时
订阅名称
订阅创建日期
任务开始时间
任务延迟时间
任务时间间隔
任务结束时间
分隔符
后缀名，生成单据的后缀名
命名规则，生成文件的命名规则
老化时长，生成的文件多长时间后会删除
所属用户，谁订阅的
压缩格式，生成单据的压缩格式
所属服务器。改订阅任务部署在哪台dsi服务器上
最后一次修改时间
导出路径，所属用户的所有订阅名称对应的文件夹的路径
数据源名称
数据输出字符集
文件积压个数阈值
文件积压超时阈值

订阅上传信息表
id
订阅id
目标服务器路径

订阅字段表
id
订阅id
字段名


run方法:从上传条目队列的map中获取所有上传条目队列，并从每个队列中获取10个上传条目，获取其中的文件对象并添加到文件map中，将文件map提交到上传的task中执行上传

task又是一个线程池，
run方法:从file的map中获取file，建立ftpclient传输